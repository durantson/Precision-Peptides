<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Molecular Intelligence | Precision Labs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
    <style>
        .mol-container { width: 100%; height: 300px; position: relative; background: radial-gradient(circle, #1e293b 0%, #0f172a 100%); }
        .sidebar-item.active { background-color: #f1f5f9; color: #2563eb; border-right: 4px solid #2563eb; }
        * { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-slate-50 font-sans antialiased text-slate-900 min-h-screen">

    <script>
        if (localStorage.getItem('portalAuthorized') !== 'true') { window.location.href = 'login.html'; }
    </script>

    <nav class="bg-white border-b border-slate-200 h-16 flex items-center px-6 justify-between sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center text-white"><i class="fas fa-cube text-xs"></i></div>
            <span class="font-bold text-lg tracking-tighter uppercase italic">Precision<span class="text-blue-600">Intelligence</span></span>
        </div>
        <a href="portal.html" class="text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-blue-600">Back to Dashboard</a>
    </nav>

    <div class="flex flex-col md:flex-row min-h-[calc(100vh-64px)]">
        <main class="flex-1 p-6 md:p-12 overflow-y-auto">
            <header class="mb-12">
                <h2 class="text-[10px] font-black uppercase tracking-[0.4em] text-blue-600 mb-2">3D Visualization</h2>
                <h1 class="text-4xl font-black italic uppercase tracking-tighter mb-4">Molecular Database</h1>
                <p class="text-slate-500 text-sm max-w-2xl">Interactive 3D spatial models. Drag to rotate, scroll to zoom. Data sourced via PubChem API.</p>
            </header>

            <div id="molecule-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                </div>
        </main>
    </div>

    <script>
        // Data for the 3D Viewer (Using PubChem CIDs for accuracy)
        const molecules = [
            { name: "Tirzepatide", cid: "16235086", formula: "C225H348N48O68" },
            { name: "Semaglutide", cid: "56843331", formula: "C187H291N45O59" },
            { name: "BPC-157", cid: "10182582", formula: "C62H98N16O22" },
            { name: "NAD+", cid: "5892", formula: "C21H27N7O14P2" },
            { name: "Cardarine", cid: "9831648", formula: "C21H18F3NO3S2" },
            { name: "Melanotan 2", cid: "92432", formula: "C50H69N15O9" },
            { name: "AICAR", cid: "65110", formula: "C9H14N4O5" },
            { name: "PT-141", cid: "10051280", formula: "C50H68N14O10" },
            { name: "DSIP", cid: "439294", formula: "C35H48N10O15" }
        ];

        function renderMolecules() {
            const grid = document.getElementById('molecule-grid');
            grid.innerHTML = molecules.map((m, idx) => `
                <div class="bg-white border border-slate-200 rounded-[2.5rem] overflow-hidden shadow-xl shadow-slate-200/50 group transition-all hover:border-blue-600">
                    <div id="container-${idx}" class="mol-container" data-cid="${m.cid}"></div>
                    
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-black italic uppercase tracking-tighter text-slate-900">${m.name}</h3>
                                <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">${m.formula}</p>
                            </div>
                            <div class="bg-slate-50 px-3 py-1 rounded-full text-[9px] font-bold text-slate-400">CID: ${m.cid}</div>
                        </div>
                        <button onclick="initViewer('container-${idx}', '${m.cid}')" class="w-full bg-slate-900 text-white py-3 rounded-xl font-black uppercase tracking-widest text-[9px] hover:bg-blue-600 transition-all">
                            Initialize 3D View
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function initViewer(id, cid) {
            const element = document.getElementById(id);
            element.innerHTML = ""; // Clear button
            
            const viewer = $3Dmol.createViewer(id, { backgroundColor: 'transparent' });
            
            // Pull 3D data from PubChem
            fetch(`https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/${cid}/record/SDF/?record_type=3d`)
                .then(response => response.text())
                .then(data => {
                    viewer.addModel(data, "sdf");
                    viewer.setStyle({}, { stick: { radius: 0.15, colorscheme: 'Jmol' }, sphere: { scale: 0.25 } });
                    viewer.zoomTo();
                    viewer.render();
                    viewer.animate({loop: "backAndForth", step: 0.5});
                })
                .catch(err => {
                    element.innerHTML = "<div class='text-white text-xs p-10'>3D Data currently unavailable for this sequence.</div>";
                });
        }

        renderMolecules();
    </script>
</body>
</html>
